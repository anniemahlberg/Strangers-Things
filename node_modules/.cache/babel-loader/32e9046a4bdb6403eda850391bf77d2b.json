{"ast":null,"code":"import _toConsumableArray from\"/Users/annamahlberg/Documents/Bootcamp/course_work/project_09/strangerThings/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _regeneratorRuntime from\"/Users/annamahlberg/Documents/Bootcamp/course_work/project_09/strangerThings/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/annamahlberg/Documents/Bootcamp/course_work/project_09/strangerThings/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import{useHistory}from\"react-router-dom\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var API_URL='https://strangers-things.herokuapp.com/api/2206-FTB-ET-WEB-FT-B';var Messages=function Messages(props){var token=props.token,userName=props.userName,setPostID=props.setPostID,setPostIndex=props.setPostIndex,setAlertMessage=props.setAlertMessage;var history=useHistory();var fetchPosts=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var posts,postsResults;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return fetch(\"\".concat(API_URL,\"/posts\"));case 3:posts=_context.sent;_context.next=6;return posts.json();case 6:postsResults=_context.sent;return _context.abrupt(\"return\",postsResults.data.posts);case 10:_context.prev=10;_context.t0=_context[\"catch\"](0);console.error('Unable to fetch posts',_context.t0);case 13:case\"end\":return _context.stop();}}},_callee,null,[[0,10]]);}));return function fetchPosts(){return _ref.apply(this,arguments);};}();var getMessages=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var messages,messagesResults;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return fetch(\"\".concat(API_URL,\"/users/me\"),{headers:{'Content-Type':'application/json','Authorization':\"Bearer \".concat(token)}});case 3:messages=_context2.sent;_context2.next=6;return messages.json();case 6:messagesResults=_context2.sent;return _context2.abrupt(\"return\",messagesResults.data.messages);case 10:_context2.prev=10;_context2.t0=_context2[\"catch\"](0);console.error('Unable to fetch messages',_context2.t0);case 13:case\"end\":return _context2.stop();}}},_callee2,null,[[0,10]]);}));return function getMessages(){return _ref2.apply(this,arguments);};}();var renderMessages=function renderMessages(messageList){var inboxContainer=document.getElementById('inbox');var sentContainer=document.getElementById('sent');var inboxContainerHTML='';var sentContainerHTML='';for(var i=0;i<messageList.length;i++){var message=messageList[i];var inboxHTML=\"\";var sentHTML=\"\";if(message.fromUser.username!==userName){inboxHTML+=\"<div class='single-message'>\\n                    <div class='sm-header'>\\n                        <div class='sm-title'>\\n                            <h2>\".concat(message.post.title,\"</h2>\\n                        </div>\\n                        <div class='sm-button'>\\n                            <button class=\\\"sm-view\\\" data-id=\").concat(message.post._id,\">View Post</button>\\n                        </div>\\n                    </div>\\n                    <div class='sm-content'>\\n                        <p>\").concat(message.content,\"</p>\\n                    </div>\\n                    <div class='sm-author'>\\n                        <h3>From: \").concat(message.fromUser.username!==userName?message.fromUser.username:\"ME\",\"</h3>\\n                    </div>\\n                </div>\");}else{sentHTML+=\"<div class='single-message'>\\n                    <div class='sm-header'>\\n                        <div class='sm-title'>\\n                            <h2>\".concat(message.post.title,\"</h2>\\n                        </div>\\n                        <div class='sm-button'>\\n                            <button class=\\\"sm-view\\\" data-id=\").concat(message.post._id,\">View Post</button>\\n                        </div>\\n                    </div>\\n                    <div class='sm-content'>\\n                        <p>\").concat(message.content,\"</p>\\n                    </div>\\n                    <div class='sm-author'>\\n                        <h3>From: \").concat(message.fromUser.username!==userName?message.fromUser.username:\"ME\",\"</h3>\\n                    </div>\\n                </div>\");}inboxContainerHTML+=inboxHTML;sentContainerHTML+=sentHTML;}inboxContainer.innerHTML=\"<h2>INBOX</h2> \".concat(inboxContainerHTML);sentContainer.innerHTML=\"<h2>SENT</h2> \".concat(sentContainerHTML);var viewMessagePostButton=_toConsumableArray(document.getElementsByClassName('sm-view'));var _loop=function _loop(x){var button1=viewMessagePostButton[x];button1.addEventListener('click',function(){setPostID(button1.dataset.id);fetchPosts().then(function(result){for(var k=0;k<result.length;k++){var currentObject=result[k];if(currentObject._id===button1.dataset.id){setPostIndex(k);history.push('/viewPost');}else{button1.setAttribute(\"disabled\",\"\");button1.innerHTML=\"This post has been deleted\";setAlertMessage(\"This post has been deleted and no longer exists.\");}}});});};for(var x=0;x<viewMessagePostButton.length;x++){_loop(x);}};var initialMessages=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(){var messages;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return getMessages();case 2:messages=_context3.sent;renderMessages(messages);case 4:case\"end\":return _context3.stop();}}},_callee3);}));return function initialMessages(){return _ref3.apply(this,arguments);};}();initialMessages();return/*#__PURE__*/_jsxs(\"div\",{id:\"message-container\",children:[/*#__PURE__*/_jsx(\"div\",{id:\"inbox\"}),/*#__PURE__*/_jsx(\"div\",{id:\"sent\"})]});};export default Messages;","map":{"version":3,"names":["useHistory","API_URL","Messages","props","token","userName","setPostID","setPostIndex","setAlertMessage","history","fetchPosts","fetch","posts","json","postsResults","data","console","error","getMessages","headers","messages","messagesResults","renderMessages","messageList","inboxContainer","document","getElementById","sentContainer","inboxContainerHTML","sentContainerHTML","i","length","message","inboxHTML","sentHTML","fromUser","username","post","title","_id","content","innerHTML","viewMessagePostButton","getElementsByClassName","x","button1","addEventListener","dataset","id","then","result","k","currentObject","push","setAttribute","initialMessages"],"sources":["/Users/annamahlberg/Documents/Bootcamp/course_work/project_09/strangerThings/src/messages.js"],"sourcesContent":["import { useHistory } from \"react-router-dom\";\n\nconst API_URL = 'https://strangers-things.herokuapp.com/api/2206-FTB-ET-WEB-FT-B'\n\nconst Messages = (props) => {\n    const { token, userName, setPostID, setPostIndex, setAlertMessage } = props;\n    const history = useHistory();\n\n    const fetchPosts = async () => {\n        try {\n            const posts = await fetch(`${API_URL}/posts`);\n            const postsResults = await posts.json();\n            return postsResults.data.posts;\n\n        } catch (err) {\n            console.error('Unable to fetch posts', err);\n        }\n    }\n\n    const getMessages = async () => {\n        try {\n            const messages = await fetch(`${API_URL}/users/me`, {\n                headers: {\n                    'Content-Type': 'application/json',\n                    'Authorization': `Bearer ${token}`\n                },})\n            const messagesResults = await messages.json();\n            return messagesResults.data.messages;\n        } catch (err) {\n            console.error('Unable to fetch messages', err);\n        }\n    }\n\n    const renderMessages = (messageList) => {    \n        let inboxContainer = document.getElementById('inbox')\n        let sentContainer = document.getElementById('sent')\n        let inboxContainerHTML = '';\n        let sentContainerHTML = '';\n        \n        for (let i = 0; i < messageList.length; i++) {\n            const message = messageList[i];\n            let inboxHTML = \"\"\n            let sentHTML = \"\"\n\n            if (message.fromUser.username !== userName) {\n                inboxHTML += \n                `<div class='single-message'>\n                    <div class='sm-header'>\n                        <div class='sm-title'>\n                            <h2>${message.post.title}</h2>\n                        </div>\n                        <div class='sm-button'>\n                            <button class=\"sm-view\" data-id=${message.post._id}>View Post</button>\n                        </div>\n                    </div>\n                    <div class='sm-content'>\n                        <p>${message.content}</p>\n                    </div>\n                    <div class='sm-author'>\n                        <h3>From: ${message.fromUser.username !== userName ? message.fromUser.username : \"ME\"}</h3>\n                    </div>\n                </div>`;\n            } else {\n                sentHTML +=\n                `<div class='single-message'>\n                    <div class='sm-header'>\n                        <div class='sm-title'>\n                            <h2>${message.post.title}</h2>\n                        </div>\n                        <div class='sm-button'>\n                            <button class=\"sm-view\" data-id=${message.post._id}>View Post</button>\n                        </div>\n                    </div>\n                    <div class='sm-content'>\n                        <p>${message.content}</p>\n                    </div>\n                    <div class='sm-author'>\n                        <h3>From: ${message.fromUser.username !== userName ? message.fromUser.username : \"ME\"}</h3>\n                    </div>\n                </div>`;\n            }\n\n            inboxContainerHTML += inboxHTML;\n            sentContainerHTML += sentHTML;\n        }\n        inboxContainer.innerHTML = `<h2>INBOX</h2> ${inboxContainerHTML}`;\n        sentContainer.innerHTML = `<h2>SENT</h2> ${sentContainerHTML}`;\n\n        let viewMessagePostButton = [...document.getElementsByClassName('sm-view')]\n        for (let x = 0; x < viewMessagePostButton.length; x++) {\n            const button1 = viewMessagePostButton[x];\n            button1.addEventListener('click', () => {\n                setPostID(button1.dataset.id);\n                fetchPosts().then((result) => {\n                    for (let k = 0; k < result.length; k++) {\n                        let currentObject = result[k]\n                        if (currentObject._id === button1.dataset.id) {\n                            setPostIndex(k)\n                            history.push('/viewPost')\n                        } else {\n                            button1.setAttribute(\"disabled\", \"\")\n                            button1.innerHTML = \"This post has been deleted\"\n                            setAlertMessage(\"This post has been deleted and no longer exists.\")\n                        }\n                    }\n                })\n            })\n        }\n\n    }\n\n    const initialMessages = async () => {\n        const messages = await getMessages();\n        renderMessages(messages)\n    }\n\n    initialMessages();\n\n    return (\n        <div id=\"message-container\">\n            <div id=\"inbox\"></div>\n            <div id=\"sent\"></div>\n        </div>\n    )\n}\n\nexport default Messages;"],"mappings":"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"},"metadata":{},"sourceType":"module"}